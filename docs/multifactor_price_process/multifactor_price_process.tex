\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb} % for "\mathbb" macro
\usepackage[round]{natbib}
\usepackage{url}
\usepackage{hyperref}

\title{Multi-Factor Commodity Price Process: Spot and Forward Price Simulation}
\author{Jake C. Fowler}
\date{January 2020}

\begin{document}
\newcommand{\+}[1]{\ensuremath{\mathbf{#1}}}

\maketitle

\section{Introduction}
This document describes a very general multi-factor price process, which is suitable
use in simulating the spot and forward prices of a a commodity under the risk-neutral
probability measure.

\bigskip

\begin{equation}
    \label{eq:forward_sde}
    \frac{dF(t, T)}{F(t, T)}=\sum_{i=1}^n \sigma_i(T)e^{-\alpha_i(T-t)}dz_i(t)
\end{equation}

Where $F(t, T)$ is the forward price observed at time $t$, for delivery over the period
starting at time $T$.
% TODO: 
% z correlation
% Reference: Warin, Clewlow and Strickland
% Describe sigma
% Describe alpha
% Give intuition of exponential weighting
% Fitting to the forward curve

\bigskip

Integrating this SDE (see Appendix I):

\begin{equation}
    \label{eq:forward_process_integrated}
    F(t_2, T) = F(t_1, t)e^{- \frac{1}{2} V(t_1, t_2, T) + I(t_1, t_2, T)}
\end{equation}

\bigskip

A closed form expression exists for the integrated covariances of
forward price log returns. This is derived in Appendix II. The evaluation of such 
covariances is essential to
understand the statistical properties that the model implies for the dynamics of 
the forward curve. It also allows the calibration of model parameters to option
market implied volatilities and historical covariances. 
Defining $C(t_1, t_2, T_1, T_2)$
as the integrated covariance from $t_1$ to $t_2$, between the log returns of forward 
contracts delivering on respective periods starting on $T_1$ and $T_2$.

\begin{equation}
    C(t_1, t_2, T_1, T_2) = \sum_{i=1}^n \sigma_i(T) \sum_{j=1}^n \sigma_j(T) \rho_{i,j} 
    e^{-\alpha_i T_1 -\alpha_j T_2} \frac{1}{\alpha_i + \alpha_j}
    (e^{t_2(\alpha_i + \alpha_j)} - e^{t_1(\alpha_i + \alpha_j)} )
\end{equation}

\section{Appendices} % TODO look up LaTex Appendix commands
\subsection{Appendix I - Integration of Forward Price SDE}
This appendix gives the detailed step for integrated the forward price process
SDE, hence getting from \ref{eq:forward_sde} to \ref{eq:forward_process_integrated}.

\bigskip

Using Ito's Lemma to calculate the stochastic differential of the natural logarithm
of the forward price.

\begin{equation}
    \label{eq:ln_forward_sde}
    d\ln(F(t, T)) = \frac{1}{F(t, T)} dF(t, T) - \frac{1}{2}
        \frac{1}{F(t, T)^2} (dF(t, T))^2
\end{equation}

Using the properties of Brownian Motion $(dz(t))^2=dt$ and $dtdz(t)=0$ the forward
price differential squared can be evaluated as follows.

\begin{equation}
    \label{eq:df_squared}
    (dF(t, T))^2 = F(t, T)^2 \sum_{i=1}^n \sum_{j=1}^n \sigma_i(T) \sigma_j(T)
    e^{-(\alpha_i + \alpha_j)(T-t)}\rho_{i,j}dt
\end{equation}

Substituting for $(dF(t, T))^2$ and $dF(t, T)$ in \ref{eq:ln_forward_sde}.

\begin{equation}
    \label{eq:ln_forward_sde_2}
    d\ln(F(t, T)) = \sum_{i=1}^n \sigma_i(T)e^{-\alpha_i(T-t)}dz_i(t) - 
    \frac{1}{2} \sum_{i=1}^n \sum_{j=1}^n \sigma_i(T) \sigma_j(T)
    e^{-(\alpha_i + \alpha_j)(T-t)}\rho_{i,j}dt
\end{equation}

The purpose of finding the stochastic differential of $ln(F(t, T))$ is to remove the
$F(t, T)$ coefficient of the Brownian motions, leaving an SDE which can be integrated
to a form where the Ito Integrals have non-stochastic integrands, and hence have a normal
distribution with known mean and variance. Integrating \ref{eq:ln_forward_sde_2}:

\begin{equation}
    \ln(F(t_2, T)) = \ln(F(t_1, t)) - \frac{1}{2} V(t_1, t_2, T) + I(t_1, t_2, T)
\end{equation}

Where:

\begin{eqnarray}
    \nonumber
    V(t_1, t_2, T) =  \sum_{i=1}^n \sigma_i(T) \sum_{j=1}^n 
    \sigma_j(T) \rho_{i,j} \int_{t_1}^{t_2} e^{-(\alpha_i + \alpha_j)(T-u)} du\\
    \nonumber
    = \sum_{i=1}^n \sigma_i(T) \sum_{j=1}^n \sigma_j(T) \rho_{i,j} 
    \frac{1}{\alpha_i + \alpha_j} (e^{-(\alpha_i + \alpha_j)(T-t_2)} - 
    e^{-(\alpha_i + \alpha_j)(T-t_1)}) \\
    \nonumber
\end{eqnarray}

And: % TODO why does above equation not have number, but below one does?

\begin{equation}
    I(t_1, t_2, T) = \sum_{i=1}^n \sigma_i(T) \int_{t_1}^{t_2} e^{-\alpha_i(T-u)}dz_i(u)
\end{equation}

Hence the forward price can be expressed as:

\begin{equation}
    F(t_2, T) = F(t_1, t)e^{- \frac{1}{2} V(t_1, t_2, T) + I(t_1, t_2, T)}
\end{equation}

% TODO define case where alpha 1 and 2 are both zero


\subsection{Appendix II - Forward Covariances}
% TODO Reference Rebonato for integrated covariance
This section derives a closed form expression for the integrated covariances of
forward price log returns. Defining $C(t_1, t_2, T_1, T_2)$
as the integrated covariance from $t_1$ to $t_2$, between the log returns of forward 
contracts delivering on respective periods starting on $T_1$ and $T_2$.

\begin{equation}
    C(t_1, t_2, T_1, T_2) = \mathbb{E}\biggl[\ln\biggl(\frac{F(t_2, T_1)}{F(t_1, T_1)} \biggr) 
    \ln\biggl(\frac{F(t_2, T_2)}{F(t_1, T_2)} \biggr) \biggr] \\
\end{equation}

Remove the products of stochastic and deterministic terms, as they will equal zero:

\begin{equation}
    C(t_1, t_2, T_1, T_2) = \mathbb{E}\bigl[ I(t_1, t_2, T_1) I(t_1, t_2, T_2) \bigr] 
\end{equation}

Using the known properties of Ito Integrals:
% TODO put in equation with expection of Ito product inside summation?

\begin{eqnarray}
    \nonumber
    C(t_1, t_2, T_1, T_2) = \sum_{i=1}^n \sigma_i(T) \sum_{j=1}^n 
    \sigma_j(T) \rho_{i,j} e^{-\alpha_i T_1 -\alpha_j T_2} 
    \int_{t_1}^{t_2} e^{u(\alpha_i + \alpha_j)} du \\
    = \sum_{i=1}^n \sigma_i(T) \sum_{j=1}^n \sigma_j(T) \rho_{i,j} 
    e^{-\alpha_i T_1 -\alpha_j T_2} \frac{1}{\alpha_i + \alpha_j}
    (e^{t_2(\alpha_i + \alpha_j)} - e^{t_1(\alpha_i + \alpha_j)} )
\end{eqnarray}


\end{document}